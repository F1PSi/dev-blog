{"author":0,"content":"Seit einigen Wochen \u00fcberwacht der sogenannte ELK unsere Applikationen und die ersten Erfahrungen sind sehr positiv.\n\n[---]\n\nELK steht f\u00fcr ElasticSearch \/ LogStash \/ Kibana, diese drei Programme bilden gemeinsam eine flexible Logging-Plattform die wir zuk\u00fcnftig sukzessive ausbauen wollen.\n\nJedes der Programme hat eine spezielle Aufgabe: \n* [ElasticSearch](https:\/\/www.elastic.co\/products\/elasticsearch) dient als Datastore\n* [LogStash](https:\/\/www.elastic.co\/products\/logstash) bereitet die Log-Files auf oder fungiert als UDP-Server\n* [Kibana](https:\/\/www.elastic.co\/products\/kibana) bereitet die Daten grafisch auf\n\n![](\/\/kcdn.at\/dev-blog\/images\/logging-epicwin\/Bildschirmfoto 2015-07-03 um 10.50.03.png)\n\n## ELK aber wie?\n\nEs gibt viele unterschiedliche M\u00f6glichkeiten wie man ELK verwenden kann. Bei uns sind alle ELK-Anwendungen auf einem zentralen Server installiert. Alle Webserver pushen mittels [UDP](https:\/\/de.wikipedia.org\/wiki\/User_Datagram_Protocol) auf diesen Server, dort h\u00f6rt LogStash auf diese Nachrichten und bereitet diese f\u00fcr die Speicherung auf.\n\nUDP hat den Vorteil das der Absender nicht auf die Empfangsbest\u00e4tigung wartet (\"verbindungsloses Protokoll\"), also wenn auf dem Logging-Server zum Beispiel Logstash nicht l\u00e4uft, dann gehen die gesendeten Daten verloren ohne das der Absender davon erf\u00e4hrt ... das ist in diesem Fall nicht so schlimm da es nur Monitoring-Daten sind. \n\nDerzeit wird jede Action (inkl. Controller) an LogStash geschickt, ausserdem haben wir die M\u00f6glichkeit unterschiedliche Messpunkte pro Controller\/Action zu senden. Diese Messpunkte lassen sich mittels Kibana als kombinierter Barchart visualisieren.\n\n![](\/\/kcdn.at\/dev-blog\/images\/logging-epicwin\/Bildschirmfoto 2015-07-03 um 10.36.03.png)\n\n## Warum monitoren?\n\nIm obigen Bild sieht man die Auswirkung eines IP-Blocks den wir setzen mussten weil ein anderer Spider karriere.at \u00fcberm\u00e4\u00dfig gecrawlt hat. Solche Dinge sieht man teilweise auch im Nagios, dort wo Server-Load usw. \u00fcberwacht werden. In diesem Fall war aber die Auswirkung nur im Kibana sichtbar.\n\nLive-Application Monitoring macht immer Sinn weil sich selbst eine komplett getestete Anwendung im Echtbetrieb anders verhalten kann als auf einem Staging-Server. Die Entwicklungsumgebung ist nie 100%ig gleich wie das Produktivsystem und Anwender kommen immer wieder auf neue kreative Wege deine Software zu \"verwenden\" :)\n\n## Lessons learned\n\nMonitoring produziert viele Daten, man sollte sehr genau darauf achten welche Daten man pusht und wie die Daten dann im ElasticSearch abgelegt werden. Es macht einen enormen Unterschied ob der Typ einer Nachricht aus nur einem oder aus zehn Buchstaben besteht ... weil man ja pro Sekunde zig solcher Nachrichten sendet.\n\nDie Auswertungen werden teilweise von Kibana im RAM durchgef\u00fchrt, wenn dieser zu wenig ist dann scheitert die Auswertung und es wird nur ein Fehler angezeigt. Das kann man aber in der Konfiguration \u00e4ndern. \u00dcberhaupt ist die Konfiguration nicht ganz einfach, man muss relativ genau aufpassen wie hoch man unterschiedliche Limits setzt, oder man bekommt st\u00e4ndig Exceptions.\n\n\n\n\n","title":"Logging #epicwin","slug":"logging-epicwin","createDate":1435913530,"hash":"99c242203b6e4a114a4791f1f38e0509","status":1}